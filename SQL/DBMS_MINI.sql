-- Creating the database
CREATE DATABASE FMS;
USE FMS;

-- Creating relations
CREATE TABLE COMPANY(
	COMPANY_ID INT AUTO_INCREMENT,
	COMPANY_NAME VARCHAR(20) NOT NULL,
	EMAIL_ID VARCHAR(25) NOT NULL,
    CONTACT_DETAILS BIGINT NOT NULL,
    STREET VARCHAR(20) NOT NULL,
    CITY VARCHAR(15) NOT NULL,
    ZIPCODE INT(6),
    CONSTRAINT PK_COMPANY PRIMARY KEY(COMPANY_ID));
    
    INSERT INTO COMPANY(COMPANY_NAME, EMAIL_ID, CONTACT_DETAILS, STREET, CITY, ZIPCODE) VALUES('AIR INDIA', 'ai@com', 1234, 'New St', 'Delhi', 411232);
	INSERT INTO COMPANY(COMPANY_NAME, EMAIL_ID, CONTACT_DETAILS, STREET, CITY, ZIPCODE) VALUES('INDIGO', 'indi@com', 4321, 'Old St', 'Ghaziabad', 411004);
	SELECT * FROM COMPANY;
CREATE TABLE CUSTOMER(
	CUSTOMER_ID INT AUTO_INCREMENT,
    CUSTOMER_NAME VARCHAR(20) NOT NULL,
    EMAIL_ID VARCHAR(25) NOT NULL,
    CUSTOMER_PASSWORD VARCHAR(30) NOT NULL,
    GENDER CHAR(1),
    DOB DATE,
    STREET VARCHAR(20),
    CITY VARCHAR(15),
    ZIPCODE INT(6),
    CONTACT_DETAILS BIGINT,
    CREDIT_POINTS INT DEFAULT 0,
    CONSTRAINT PK_CUSTOMER PRIMARY KEY(CUSTOMER_ID),
    CONSTRAINT UC_CUSTOMER UNIQUE(EMAIL_ID));
    SELECT * FROM CUSTOMER;
    
INSERT INTO CUSTOMER(CUSTOMER_NAME, EMAIL_ID, CUSTOMER_PASSWORD, GENDER, DOB, STREET, CITY, ZIPCODE, CONTACT_DETAILS)
 VALUES ('Jay', 'j@', 'jay', 'M', '2000-01-01', 'New street', 'Pune', 411005, 99887);    
CREATE TABLE SYS_ADMIN(
	ADMIN_ID INT AUTO_INCREMENT,
    ADMIN_NAME VARCHAR(20) NOT NULL,
    EMAIL_ID VARCHAR(25) NOT NULL,
    ADMIN_PASSWORD VARCHAR(30) NOT NULL,
    GENDER CHAR(1),
    DOB DATE,
    STREET VARCHAR(20),
    CITY VARCHAR(15),
    ZIPCODE INT(6),
    CONTACT_DETAILS BIGINT,
    HIRE_DATE DATE,
    CONSTRAINT PK_ADMIN PRIMARY KEY(ADMIN_ID),
    CONSTRAINT UC_ADMIN UNIQUE(EMAIL_ID),
    CONSTRAINT CHK_ADMIN CHECK(GENDER IN ('M', 'F', 'T')));
INSERT INTO SYS_ADMIN(ADMIN_NAME, EMAIL_ID, ADMIN_PASSWORD, GENDER, DOB, STREET, CITY, ZIPCODE, CONTACT_DETAILS, HIRE_DATE)
 VALUES ('Admin', 'a@', 'admin', 'M', '2000-01-01', 'New street', 'Pune', 411005, 99887, '2020-09-14'); 
 
	SELECT * FROM SYS_ADMIN;
    
    DELETE FROM SYS_ADMIN WHERE ADMIN_ID=2;
CREATE TABLE CITY(
	CITY_CODE VARCHAR(10),
    CITY_NAME VARCHAR(15) NOT NULL,
    ZIPCODE INT(6),
    AIRPORT VARCHAR(50) NOT NULL,
    CONSTRAINT PK_CITY PRIMARY KEY(CITY_CODE));
    INSERT INTO CITY VALUES('PUN', 'Pune', 411000, 'Pune Airprt');
	INSERT INTO CITY VALUES('BOM', 'Mumbai', 311000, 'Chhatrapati Shivaji Airport');
	INSERT INTO CITY VALUES('UDR', 'Udaipur', 211000, 'Maharana Pratap Airport');
	INSERT INTO CITY VALUES('DEL', 'Delhi', 511000, 'Indira Gandhi Airprt');
    SELECT *FROM CITY;
    
    


/*CREATE TABLE AMENITIES(
	AMENITY_ID INT AUTO_INCREMENT,
    AMENITY_SET VARCHAR(40),
    CONSTRAINT PK_AMENITY PRIMARY KEY(AMENITY_ID));
*/
    
CREATE TABLE ROUTE(
	ROUTE_ID INT AUTO_INCREMENT,
    START_CITY VARCHAR(10),
    DEST_CITY VARCHAR(10),
    TIME_TAKEN TIME NOT NULL,
    CONSTRAINT PK_START_ROUTE PRIMARY KEY(ROUTE_ID),
    CONSTRAINT FK1_ROUTE FOREIGN KEY(START_CITY) REFERENCES CITY(CITY_CODE) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK2_ROUTE FOREIGN KEY(DEST_CITY) REFERENCES CITY(CITY_CODE) ON DELETE CASCADE ON UPDATE CASCADE);
    INSERT INTO ROUTE(START_CITY, DEST_CITY, TIME_TAKEN) VALUES('BOM', 'DEL', '04:10:00');
	INSERT INTO ROUTE(START_CITY, DEST_CITY, TIME_TAKEN) VALUES('DEL', 'UDR', '01:15:00');
	INSERT INTO ROUTE(START_CITY, DEST_CITY, TIME_TAKEN) VALUES('DEL', 'PUN', '04:20:00');
    SELECT * FROM ROUTE;
    
CREATE TABLE FLIGHT(
	FLIGHT_NO VARCHAR(10),
    MODEL_NAME VARCHAR(25),
    DEPARTURE_TIME TIME NOT NULL,
    ROUTE_ID INT,
    PRICE FLOAT NOT NULL,
    BAGGAGE_ALLOWANCE INT,
	NO_OF_FIRSTCLASS_SEATS INT NOT NULL,
    NO_OF_ECONOMY_SEATS INT NOT NULL,
    NO_OF_BUSINESS_SEATS INT NOT NULL,
    NO_OF_PREMIUM_SEATS INT NOT NULL,
    COMPANY_ID INT,
    CONSTRAINT PK_FLIGHT PRIMARY KEY(FLIGHT_NO),
    CONSTRAINT FK1_FLIGHT FOREIGN KEY(ROUTE_ID) REFERENCES ROUTE(ROUTE_ID) ON DELETE SET NULL ON UPDATE CASCADE,
    CONSTRAINT FK2_FLIGHT FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID) ON DELETE CASCADE ON UPDATE CASCADE);
    
    INSERT INTO FLIGHT VALUES('AI 0946', 'AIRBUS 101','12:30:00', 8, 2000,  10, 20, 30, 40, 50, 1);
	INSERT INTO FLIGHT VALUES('6E 402', 'JETLINER','03:30:00', 9, 3500,  10, 30, 40, 50, 60, 2);
	INSERT INTO FLIGHT VALUES('6E 920', 'JETLINER','09:30:00',  8, 3000,  10, 40, 40, 50, 20, 2);
	INSERT INTO FLIGHT VALUES('AI 111', 'AIRBUS 101','03:30:00', 10, 2500,  10, 40, 50, 60, 80, 1);
    
    DESC FLIGHT;
    
    UPDATE FLIGHT SET NO_OF_FIRSTCLASS_SEATS = 10, NO_OF_ECONOMY_SEATS=25 WHERE FLIGHT_NO='AI 111';
        UPDATE FLIGHT SET NO_OF_PREMIUM_SEATS=0 WHERE FLIGHT_NO='AI 111';
    SELECT * FROM FLIGHT;
    

CREATE TABLE PRICE_FACTOR(
	FIRSTCLASS_FACTOR FLOAT,
    ECONOMY_FACTOR FLOAT,
    BUSINESS_FACTOR FLOAT,
    PREMIUM_FACTOR FLOAT);
    
    INSERT INTO PRICE_FACTOR VALUES(1.5, 1, 2, 2.5);

/*CREATE TABLE BUS(
	VEHICLE_ID VARCHAR(10),
    NO_OF_SLEEPER_SEATS INT NOT NULL,
    NO_OF_SEATER_SEATS INT NOT NULL,
    CONSTRAINT PK_BUS PRIMARY KEY(VEHICLE_ID),
    CONSTRAINT FK_BUS FOREIGN KEY(VEHICLE_ID) REFERENCES VEHICLE(VEHICLE_ID) ON DELETE CASCADE ON UPDATE CASCADE);
  */  
    
/*CREATE TABLE CAR(
	VEHICLE_ID VARCHAR(10),
    NO_OF_SEATS INT NOT NULL,
    CONSTRAINT PK_CAR PRIMARY KEY(VEHICLE_ID),
    CONSTRAINT FK_CAR FOREIGN KEY(VEHICLE_ID) REFERENCES VEHICLE(VEHICLE_ID) ON DELETE CASCADE ON UPDATE CASCADE);
*/
    
/*CREATE TABLE EMPLOYEE(
	EMP_ID INT AUTO_INCREMENT,
    EMP_NAME VARCHAR(20) NOT NULL,
    GENDER CHAR(1),
    SALARY FLOAT,
    AADHAAR_NO INT(12) NOT NULL,
    EMAIL_ID VARCHAR(25),
    CONTACT_DETAILS INT(10) NOT NULL,
    DOB DATE,
    STREET VARCHAR(20) NOT NULL,
    CITY VARCHAR(15) NOT NULL,
    ZIPCODE INT(6),
    EMP_ROLE VARCHAR(15),
    MGR_ID INT,
    VEHICLE_ID VARCHAR(10),
    COMPANY_ID INT,
    CONSTRAINT PK_EMPLOYEE PRIMARY KEY(EMP_ID),
    CONSTRAINT FK1_EMPLOYEE FOREIGN KEY(MGR_ID) REFERENCES EMPLOYEE(EMP_ID) ON DELETE SET NULL ON UPDATE CASCADE,
	CONSTRAINT FK2_EMPLOYEE FOREIGN KEY(VEHICLE_ID) REFERENCES VEHICLE(VEHICLE_ID) ON DELETE SET NULL ON UPDATE CASCADE,
    CONSTRAINT FK3_EMPLOYEE FOREIGN KEY(COMPANY_ID) REFERENCES COMPANY(COMPANY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT UC_EMPLOYEE UNIQUE(EMAIL_ID),
    CONSTRAINT CHK1_EMPLOYEE CHECK(GENDER IN ('M', 'F', 'T')));
*/

/*CREATE TABLE JOURNEY_CAR(
	JOURNEY_ID INT AUTO_INCREMENT,
    JOURNEY_DATE DATE NOT NULL, 
    AVAILABLE_SEATS INT NOT NULL,
    VEHICLE_ID VARCHAR(10),
    JOURNEY_STATUS INT DEFAULT 1,
    CONSTRAINT PK_JOURNEY_CAR PRIMARY KEY(JOURNEY_ID),
    CONSTRAINT FK_JOURNEY_CAR FOREIGN KEY(VEHICLE_ID) REFERENCES VEHICLE(VEHICLE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT CHK_JOURNEY_CAR CHECK(JOURNEY_STATUS IN (0, 1)));
*/
    
/*CREATE TABLE JOURNEY_BUS(
	JOURNEY_ID INT AUTO_INCREMENT,
    JOURNEY_DATE DATE NOT NULL, 
    AVAILABLE_SLEEPER_SEATS INT NOT NULL,
	AVAILABLE_SEATER_SEATS INT NOT NULL,
    VEHICLE_ID VARCHAR(10),
    JOURNEY_STATUS INT DEFAULT 1,
    CONSTRAINT PK_JOURNEY_BUS PRIMARY KEY(JOURNEY_ID),
    CONSTRAINT FK_JOURNEY_BUS FOREIGN KEY(VEHICLE_ID) REFERENCES VEHICLE(VEHICLE_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT CHK_JOURNEY_BUS CHECK(JOURNEY_STATUS IN (0, 1)));
*/
    
CREATE TABLE JOURNEY_FLIGHT(
	JOURNEY_ID INT AUTO_INCREMENT,
    JOURNEY_DATE DATE, 
    AVAILABLE_FIRSTCLASS_SEATS INT,
	AVAILABLE_ECONOMY_SEATS INT,
    AVAILABLE_BUSINESS_SEATS INT,
    AVAILABLE_PREMIUM_SEATS INT,
    FLIGHT_NO VARCHAR(10),
    JOURNEY_STATUS INT DEFAULT 1,
    CONSTRAINT PK_JOURNEY_FLIGHT PRIMARY KEY(JOURNEY_ID),
    CONSTRAINT FK_JOURNEY_FLIGHT FOREIGN KEY(FLIGHT_NO) REFERENCES FLIGHT(FLIGHT_NO) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT CHK_JOURNEY_FLIGHT CHECK(JOURNEY_STATUS IN (0, 1)));
    
    DESC JOURNEY_FLIGHT;
    
    SELECT * FROM JOURNEY_FLIGHT;
    
    INSERT INTO JOURNEY_FLIGHT(JOURNEY_DATE, AVAILABLE_FIRSTCLASS_SEATS, AVAILABLE_ECONOMY_SEATS, AVAILABLE_BUSINESS_SEATS, AVAILABLE_PREMIUM_SEATS, FLIGHT_NO, JOURNEY_STATUS)
		VALUES('2020-09-15', 20, 30, 40, 50, 'AI 0946', 1);
    INSERT INTO JOURNEY_FLIGHT(JOURNEY_DATE, AVAILABLE_FIRSTCLASS_SEATS, AVAILABLE_ECONOMY_SEATS, AVAILABLE_BUSINESS_SEATS, AVAILABLE_PREMIUM_SEATS, FLIGHT_NO, JOURNEY_STATUS)
		VALUES('2020-09-16', 30, 40, 50, 60, '6E 402', 1);
	INSERT INTO JOURNEY_FLIGHT(JOURNEY_DATE, AVAILABLE_FIRSTCLASS_SEATS, AVAILABLE_ECONOMY_SEATS, AVAILABLE_BUSINESS_SEATS, AVAILABLE_PREMIUM_SEATS, FLIGHT_NO, JOURNEY_STATUS)
		VALUES('2020-09-15', 40, 40, 50, 20, '6E 920', 1);
    INSERT INTO JOURNEY_FLIGHT(JOURNEY_DATE, AVAILABLE_FIRSTCLASS_SEATS, AVAILABLE_ECONOMY_SEATS, AVAILABLE_BUSINESS_SEATS, AVAILABLE_PREMIUM_SEATS, FLIGHT_NO, JOURNEY_STATUS)
		VALUES('2020-09-15', 40, 50, 60, 80, 'AI 111', 1);  
        
	DESC JOURNEY_FLIGHT;
    SELECT * FROM JOURNEY_FLIGHT;
    
    
    
/*CREATE TABLE BOOKS_CAR(
	JOURNEY_ID INT,
    CUSTOMER_ID INT,
    DATE_OF_BOOKING DATE NOT NULL,
    PRICE FLOAT,
    CONSTRAINT PK_BOOKS_CAR PRIMARY KEY(JOURNEY_ID, CUSTOMER_ID, DATE_OF_BOOKING),
    CONSTRAINT FK1_BOOKS_CAR FOREIGN KEY(JOURNEY_ID) REFERENCES  JOURNEY_CAR(JOURNEY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK2_BOOKS_CAR FOREIGN KEY(CUSTOMER_ID) REFERENCES  CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE ON UPDATE CASCADE);
*/
    
/*CREATE TABLE BOOKS_BUS(
	JOURNEY_ID INT,
    CUSTOMER_ID INT,
    DATE_OF_BOOKING DATE NOT NULL,
	PRICE FLOAT,
    SEAT_TYPE VARCHAR(15),
    SEAT_NO VARCHAR(10),
    CONSTRAINT PK_BOOKS_BUS PRIMARY KEY(JOURNEY_ID, CUSTOMER_ID, DATE_OF_BOOKING),
    CONSTRAINT FK1_BOOKS_BUS FOREIGN KEY(JOURNEY_ID) REFERENCES  JOURNEY_BUS(JOURNEY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK2_BOOKS_BUS FOREIGN KEY(CUSTOMER_ID) REFERENCES  CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT CHK_BOOKS_BUS CHECK(SEAT_TYPE IN ('SLEEPER', 'SEATER')));
*/
 
CREATE TABLE BOOKS_FLIGHT(
	JOURNEY_ID INT,
    CUSTOMER_ID INT,
    DATE_OF_BOOKING DATETIME NOT NULL,
	PRICE FLOAT,
    SEAT_TYPE VARCHAR(15),
    SEAT_NO VARCHAR(10),
    CONSTRAINT PK_BOOKS_FLIGHT PRIMARY KEY(JOURNEY_ID, CUSTOMER_ID, DATE_OF_BOOKING),
    CONSTRAINT FK1_BOOKS_FLIGHT FOREIGN KEY(JOURNEY_ID) REFERENCES  JOURNEY_FLIGHT(JOURNEY_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT FK2_BOOKS_FLIGHT FOREIGN KEY(CUSTOMER_ID) REFERENCES  CUSTOMER(CUSTOMER_ID) ON DELETE CASCADE ON UPDATE CASCADE,
    CONSTRAINT CHK_BOOKS_FLIGHT CHECK(SEAT_TYPE IN ('FIRSTCLASS', 'ECONOMY', 'BUSINESS', 'PREMIUM')));
    
INSERT INTO BOOKS_FLIGHT VALUES(4, 1, '2020-09-15', 100, 'FIRSTCLASS', 3);
INSERT INTO BOOKS_FLIGHT VALUES(4, 1, '2020-09-15 12:30:22', 100, 'FIRSTCLASS', 6);

DROP TABLE BOOKS_FLIGHT;
SELECT * FROM BOOKS_FLIGHT;





SELECT START_CITY, DEST_CITY 
FROM ROUTE 
WHERE ROUTE_ID=(SELECT ROUTE_ID 
				FROM FLIGHT 
                WHERE FLIGHT_NO=(SELECT FLIGHT_NO FROM JOURNEY_FLIGHT WHERE JOURNEY_ID=6));

-- Checking created tables
SELECT COUNT(*) FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'TMS';


-- DROP DATABASE TMS;

    
    
    
    
   
	
    
    

    
    

    
    
    
    
    
    